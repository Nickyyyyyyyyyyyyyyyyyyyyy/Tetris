<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Tetris</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === Custom Styles === */

        /* Animations */
        @keyframes pulse {
            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .pulse-animation {
            animation: pulse 1.5s infinite;
        }

        .rotate-animation {
            animation: rotate 2s linear infinite;
        }

        /* Tetris Block Styles */
        .tetris-block {
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            transition: all 0.1s ease;
        }

        .tetris-block:hover {
            filter: brightness(1.1);
        }

        .ghost-piece {
            opacity: 0.3;
        }

        .touch-control {
            touch-action: none;
            user-select: none;
        }

        /* Game Board Styles */
        #game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
            width: 250px;
            height: 500px;
            gap: 1px;
            background-color: #2d3748;
            padding: 1px;
            border-radius: 0.5rem;
            border: 1px solid #4a5568;
            overflow: hidden;
        }

        /* Next/Hold Piece Styles */
        #next-piece,
        #hold-piece {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 1px;
            height: 6rem;
            width: 6rem;
            background-color: #1a202c;
            border-radius: 0.25rem;
            padding: 2px;
        }
    </style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4 overflow-hidden">

    <div id="main-menu"
        class="fixed inset-0 bg-gray-900 bg-opacity-95 flex flex-col items-center justify-center z-50 transition-opacity duration-300">
        <div class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-purple-500 via-pink-500 to-blue-500 bg-clip-text text-transparent">
                MODERN TETRIS
            </h1>
            <p class="text-gray-400 text-lg">The classic puzzle game reimagined</p>
        </div>
        <div class="flex flex-col gap-4 w-full max-w-xs">
            <button id="start-game-btn"
                class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg text-xl transition-all transform hover:scale-105 flex items-center justify-center">
                <i class="fas fa-play mr-3"></i> Start Game
            </button>
            <button id="controls-btn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-xl transition-all transform hover:scale-105 flex items-center justify-center">
                <i class="fas fa-gamepad mr-3"></i> Controls
            </button>
            <button id="sound-toggle-btn"
                class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-8 rounded-lg text-xl transition-all transform hover:scale-105 flex items-center justify-center">
                <i class="fas fa-volume-up mr-3"></i> Sound: ON
            </button>
        </div>
        <div class="mt-12 text-gray-500 text-sm">
            <p>Use keyboard or touch controls to play</p>
        </div>
    </div>

    <div id="controls-modal"
        class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Game Controls</h2>
                <button id="close-controls-btn" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="flex items-center">
                    <div class="bg-gray-700 rounded-lg p-3 mr-4 w-12 h-12 flex items-center justify-center"><i
                            class="fas fa-arrow-left text-xl"></i></div><span>Move Left (Left Arrow / A)</span>
                </div>
                <div class="flex items-center">
                    <div class="bg-gray-700 rounded-lg p-3 mr-4 w-12 h-12 flex items-center justify-center"><i
                            class="fas fa-arrow-right text-xl"></i></div><span>Move Right (Right Arrow / D)</span>
                </div>
                <div class="flex items-center">
                    <div class="bg-gray-700 rounded-lg p-3 mr-4 w-12 h-12 flex items-center justify-center"><i
                            class="fas fa-arrow-down text-xl"></i></div><span>Soft Drop (Down Arrow / S)</span>
                </div>
                <div class="flex items-center">
                    <div class="bg-gray-700 rounded-lg p-3 mr-4 w-12 h-12 flex items-center justify-center"><i
                            class="fas fa-arrow-up text-xl"></i></div><span>Rotate (Up Arrow / W)</span>
                </div>
                <div class="flex items-center">
                    <div class="bg-gray-700 rounded-lg p-3 mr-4 w-12 h-12 flex items-center justify-center"><i
                            class="fas fa-space text-xl"></i></div><span>Hard Drop (Space)</span>
                </div>
                <div class="flex items-center">
                    <div class="bg-gray-700 rounded-lg p-3 mr-4 w-12 h-12 flex items-center justify-center"><i
                            class="fas fa-hand text-xl"></i></div><span>Hold (Shift / C)</span>
                </div>
                <div class="flex items-center">
                    <div class="bg-gray-700 rounded-lg p-3 mr-4 w-12 h-12 flex items-center justify-center"><i
                            class="fas fa-pause text-xl"></i></div><span>Pause (P / Esc)</span>
                </div>
            </div>
            <div class="mt-8 pt-4 border-t border-gray-700">
                <h3 class="font-bold mb-2">Touch Controls</h3>
                <p class="text-gray-400 text-sm">Swipe Left/Right/Down. Swipe Up or Tap to Rotate. Use on-screen
                    buttons for Hard Drop and Pause.</p>
            </div>
            <button id="back-to-menu-btn"
                class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all"><i
                    class="fas fa-arrow-left mr-2"></i> Back</button>
        </div>
    </div>

    <div id="game-container" class="relative w-full max-w-lg flex justify-center items-start gap-4 hidden">
        <div class="flex flex-col items-center">
            <div class="flex justify-between items-center mb-4 w-full" style="max-width: 250px;">
                <div class="bg-gray-800 rounded-lg p-2 shadow-lg text-center">
                    <div class="text-xs text-gray-400">Score</div>
                    <div id="score" class="text-xl font-bold">0</div>
                </div>
                <div class="text-center">
                    <h1 class="text-xl font-bold bg-gradient-to-r from-purple-500 to-blue-500 bg-clip-text text-transparent">
                        TETRIS</h1>
                    <div class="text-xs text-gray-400">Level: <span id="level-display">1</span></div>
                </div>
                <div class="flex gap-2">
                    <button id="pause-btn" title="Pause (P/Esc)"
                        class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold w-10 h-10 rounded-lg transition-all flex items-center justify-center"><i
                            class="fas fa-pause"></i></button>
                    <button id="menu-btn" title="Main Menu"
                        class="bg-gray-700 hover:bg-gray-600 text-white font-bold w-10 h-10 rounded-lg transition-all flex items-center justify-center"><i
                            class="fas fa-bars"></i></button>
                </div>
            </div>

            <div class="relative">
                <div id="game-board"></div>
                <div id="pause-overlay"
                    class="absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center rounded-lg hidden">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold mb-4">PAUSED</h2>
                        <button id="resume-btn"
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105"><i
                                class="fas fa-play mr-2"></i> Resume</button>
                    </div>
                </div>
                <div id="game-over-overlay"
                    class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center rounded-lg hidden">
                    <div class="text-center p-6">
                        <h2 class="text-3xl font-bold text-red-500 mb-2">GAME OVER</h2>
                        <div class="text-xl mb-4">Score: <span id="final-score" class="font-bold">0</span></div>
                        <div class="flex gap-2 justify-center">
                            <button id="restart-btn"
                                class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105"><i
                                    class="fas fa-redo mr-2"></i> Play Again</button>
                            <button id="back-to-menu-btn-2"
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105"><i
                                    class="fas fa-home mr-2"></i> Menu</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-2 shadow-lg mt-4 text-center w-24">
                <div class="text-xs text-gray-400">Lines</div>
                <div id="lines" class="text-xl font-bold">0</div>
            </div>
        </div>

        <div class="flex flex-col gap-4 w-24 mt-16">
            <div class="bg-gray-800 rounded-lg p-2 shadow-lg">
                <div class="text-xs text-gray-400 mb-1 text-center">Next</div>
                <div id="next-piece"></div>
            </div>
            <div class="bg-gray-800 rounded-lg p-2 shadow-lg">
                <div class="text-xs text-gray-400 mb-1 text-center">Hold</div>
                <div id="hold-piece"></div>
            </div>
        </div>

        <div id="touch-controls"
            class="fixed bottom-4 left-0 right-0 px-4 grid grid-cols-3 gap-2 touch-control md:hidden">
            <div class="col-span-3 flex justify-center gap-2">
                <button id="rotate-btn"
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-lg text-xl touch-control"><i
                        class="fas fa-rotate"></i></button>
                <button id="hard-drop-btn"
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-lg text-xl touch-control"><i
                        class="fas fa-arrow-down-to-line"></i></button>
            </div>
            <button id="left-btn"
                class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-8 px-6 rounded-lg text-xl touch-control"><i
                    class="fas fa-arrow-left"></i></button>
            <button id="down-btn"
                class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-8 px-6 rounded-lg text-xl touch-control"><i
                    class="fas fa-arrow-down"></i></button>
            <button id="right-btn"
                class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-8 px-6 rounded-lg text-xl touch-control"><i
                    class="fas fa-arrow-right"></i></button>
        </div>
    </div>

    <audio id="move-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-quick-jump-arcade-game-239.mp3"
        preload="auto"></audio>
    <audio id="rotate-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"
        preload="auto"></audio>
    <audio id="drop-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-mechanical-bling-210.mp3"
        preload="auto"></audio>
    <audio id="clear-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"
        preload="auto"></audio>
    <audio id="game-over-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3"
        preload="auto"></audio>

    <script>
        // === Game State ===
        const gameState = {
            board: Array(20).fill().map(() => Array(10).fill(0)),
            currentPiece: null,
            nextPiece: null
